<!DOCTYPE html>
<html style="font-size: 16px;" lang="en">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
  <meta name="keywords" content="INTUITIVE">
  <meta name="description" content="">
  <title>Device</title>
  <link rel="icon" type="image/x-icon" href="/icons/leake.png">
  <link rel="stylesheet" href="nicepage.css" media="screen">
  <link rel="stylesheet" href="Device-1-.css" media="screen">
  <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
  <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
  <meta name="generator" content="Nicepage 5.11.4, nicepage.com">
  <link id="u-theme-google-font" rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
  <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": "LeakE"
}</script>
  <meta name="theme-color" content="#478ac9">
  <meta property="og:title" content="Device 1">
  <meta property="og:description" content="">
  <meta property="og:type" content="website">
  <meta data-intl-tel-input-cdn-path="intlTelInput/">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous" />
</head>

<body class="u-body u-xl-mode" data-lang="en">
  <header class="u-clearfix u-header u-header" id="sec-90b5">
    <div class="u-clearfix u-sheet u-valign-middle-xs u-sheet-1">
      <nav class="u-menu u-menu-one-level u-offcanvas u-menu-1">
        <div class="menu-collapse" style="font-size: 1rem; letter-spacing: 0px;">
          <a class="u-button-style u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base"
            href="#">
            <svg class="u-svg-link" viewBox="0 0 24 24">
              <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use>
            </svg>
            <svg class="u-svg-content" version="1.1" id="menu-hamburger" viewBox="0 0 16 16" x="0px" y="0px"
              xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg">
              <g>
                <rect y="1" width="16" height="2"></rect>
                <rect y="7" width="16" height="2"></rect>
                <rect y="13" width="16" height="2"></rect>
              </g>
            </svg>
          </a>
        </div>
        <div class="u-custom-menu u-nav-container">
          <ul class="u-nav u-unstyled u-nav-1">
            <li class="u-nav-item"><a
                class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-3-base"
                href="Home.html" style="padding: 10px 20px;">Home</a>
            </li>
            <li class="u-nav-item"><a
                class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-3-base"
                href="Contact.html" style="padding: 10px 20px;">Contact</a>
            </li>
            <li class="u-nav-item"><a class="u-button-style u-nav-link u-text-active-palette-1-base u-text-hover-palette-3-base" onclick="showDebug()" style="padding: 10px 20px;">Show Debug</a>
            </li>
          </ul>
        </div>
        <div class="u-custom-menu u-nav-container-collapse">
          <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
            <div class="u-inner-container-layout u-sidenav-overflow">
              <div class="u-menu-close"></div>
              <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2">
                <li class="u-nav-item"><a class="u-button-style u-nav-link" href="Home.html">Home</a>
                </li>
                <li class="u-nav-item"><a class="u-button-style u-nav-link" href="Contact.html">Contact</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
        </div>
      </nav>
      <a href="Home.html" class="" data-image-width="80" data-image-height="40">
        <img src="./icons/leake.png" alt="" data-image-width="200" data-image-height="200"
          style="height: 5rem; width: 5rem;" /> </a>
    </div>
  </header>
  <section class="u-clearfix u-section-1" id="sec-19b7">
    <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
      <p class="u-text u-text-default u-text-1">Last Updated: <span id="lastUpdated">Loading...</span></p>
      <h1 class="u-text u-text-default u-text-2" id="deviceName">Loading...</h1>
    </div>
  </section>
  <div class="row justify-content-center">
    <div class="text-center mx-3 fs-5 fw-bold" style="width: 10rem; height: 2.5rem;">
      Pressure</div>
      <div class="text-center mx-3 fs-5 fw-bold" style="width: 10rem; height: 2.5rem;">
      Flow
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="card text-bg-info mb-3 rounded-circle mx-3" style="width: 10rem; height: 10rem;">
      <div class="card-body">
        <h5 class="card-title text-center mt-5 fs-3" id="pressure">Loading</h5>
        <p class="card-text text-center">PSI
        </p>
      </div>
    </div>
    <div class="card text-bg-info mb-3 rounded-circle mx-3" style="width: 10rem; height: 10rem;">
      <div class="card-body">
        <h5 class="card-title text-center mt-5 fs-3" id="flow">Loading</h5>
        <p class="card-text text-center">Volts
        </p>
      </div>
    </div>
  </div>
  <div class="mx-auto mt-3 w-100 " style="max-width: 20rem;">
    <div class="card" style="">
      <!-- <div class="card-header py-1" >
        State
      </div> -->
      <div class="card-body text-center" id="state_desc_box">
        <h5 class="card-title m-0" id="state_desc">Loading State...</h5>
        <!-- <p class="card-text" >With supporting text below as a natural lead-in to additional content.</p> -->
        <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
      </div>
      <!-- <div class="card-footer text-muted py-1" id="last_update">
        Calculating...
      </div> -->
    </div>
  </div>
  <div class="w-100 mt-5" style="height: 10rem;">
    <div class="mx-auto mb-3" style="width: 300px;"> 
      <div class="fw-bold">Shut-Off Valve Controls</div>
    </div>
    <div class="form-check p-0 form-switch " style="text-align: center;">
      <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckTrigger">
      <label class="form-check-label" for="flexSwitchCheckTrigger">Trigger</label>
    </div>
    <div class="mx-auto mb-3" style="">
      <div class="fw-normal" style="font-size: 0.8rem; text-align: center;">Closed ←→ Open</div>
    </div>
  </div>
  <div class="text-center mt-5 text-bg-danger d-none" style="height: 20rem;
      overflow: scroll;
      scroll-behavior: auto;" id="debug_box">Debug: <span id="debug"></span>
  </div>
  <div class="modal" tabindex="-1" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title fw-bold"><img src="./icons/warning.png" alt="" style="height: 3rem; width: 3rem;" />Water leak</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body py-1 border-0">
          <p class="my-0">There has been abnormal patterns in your water system. Confirm if there is a leak present.</p>
        </div>
        <div class="modal-footer py-2 border-0">
          <button type="button" class="btn btn-secondary rounded-5 px-4" id="leaking_yes_btn" data-bs-dismiss="modal">NO</button>
          <button type="button" class="btn btn-danger rounded-5 px-4" data-bs-dismiss="modal">YES</button>
        </div>
      </div>
    </div>
  </div>
  <footer class="d-flex flex-wrap justify-content-between align-items-center border-top bg-secondary">
    <div class="col-md-4 d-flex align-items-center">
      <a href="/" class="mb-3 me-2 mb-md-0 text-decoration-none lh-1">
      </a>
      <span class="mb-auto p-2 text-white fw-light">© Copyright 2023 by LeakE</span>
    </div>
  </footer>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
    integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
    crossorigin="anonymous"></script>
  <script type="text/javascript">
    let coolDown = false;
    let trigger = document.getElementById("flexSwitchCheckTrigger");
    trigger.addEventListener("click", function () {
      if (trigger.checked) {
        coolDown = true;
        console.log(httpTrigger());
        console.log("Trigger On");
      } else {
        coolDown = true;
        console.log(httpTrigger());
        console.log("Trigger Off");
      }
    });
    function httpTrigger() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", "https://5u31ux7w73.execute-api.ca-central-1.amazonaws.com/default/Trigger_Device", false);
      xmlHttp.setRequestHeader("Access-Control-Allow-Origin", "*");
      xmlHttp.setRequestHeader("Access-Control-Allow-Headers", "Content-Type");
      xmlHttp.setRequestHeader("Content-Type", "application/json");
      xmlHttp.setRequestHeader("deviceName", "demoDevice");
      xmlHttp.setRequestHeader("deviceKey", "abc123");
      xmlHttp.setRequestHeader("action", "toggleValve");
      xmlHttp.setRequestHeader("timeScale", "minute");
      xmlHttp.send(null);
      document.getElementById("debug").innerHTML += "<br>" + Date() + ": " + "(Device Name: demoDevice | deviceKey: abc123 | action: toggleValve | timeScale: timeScale)"+ xmlHttp.responseText;
      document.getElementById("debug").innerHTML = document.getElementById("debug").innerHTML.split("<br>").slice(-15).join("<br>");
      // return xmlHttp.responseText;
    }

    function httpTriggerBySecond() {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", "https://5u31ux7w73.execute-api.ca-central-1.amazonaws.com/default/Trigger_Device", false);
        xmlHttp.setRequestHeader("Access-Control-Allow-Origin", "*");
        xmlHttp.setRequestHeader("Access-Control-Allow-Headers", "Content-Type");
        xmlHttp.setRequestHeader("Content-Type", "application/json");
        xmlHttp.setRequestHeader("deviceName", "demoDevice");
        xmlHttp.setRequestHeader("deviceKey", "abc123");
        xmlHttp.setRequestHeader("action", "postData");
        xmlHttp.setRequestHeader("timeScale", "second");
        xmlHttp.send(null);
        document.getElementById("debug").innerHTML += "<br>" + Date() + ": " + "(Device Name: demoDevice | deviceKey: abc123 | action: toggleValve | timeScale: second)" + xmlHttp.responseText;
        document.getElementById("debug").innerHTML = document.getElementById("debug").innerHTML.split("<br>").slice(-15).join("<br>");
        return xmlHttp.responseText;
      }

    function httpData() {
      var xmlHttp = new XMLHttpRequest();
      xmlHttp.open("GET", "https://0cuhbvxq73.execute-api.ca-central-1.amazonaws.com/default/Read_Last", false);
      xmlHttp.setRequestHeader("Access-Control-Allow-Origin", "*");
      xmlHttp.setRequestHeader("Access-Control-Allow-Headers", "Content-Type");
      xmlHttp.setRequestHeader("Content-Type", "application/json");
      xmlHttp.setRequestHeader("deviceName", "demoDevice");
      xmlHttp.setRequestHeader("deviceKey", "abc123");
      xmlHttp.setRequestHeader("action", "postData");
      xmlHttp.setRequestHeader("timeScale", "minute");
      xmlHttp.send(null);
      document.getElementById("debug").innerHTML += "<br>" + Date() + ": (demoDevice | abc123 | postData | minute)" +  xmlHttp.responseText;
      document.getElementById("debug").innerHTML = document.getElementById("debug").innerHTML.split("<br>").slice(-15).join("<br>");
      return xmlHttp.responseText;
    }

    //if click yes in modal, then trigger the input
    function triggerInput() {
      document.getElementById("flexSwitchCheckTrigger").click();
    }

    //add listener to yest button in modal
    document.getElementById("leaking_yes_btn").addEventListener("click", triggerInput);

    let valve_state = 1;
    let last_state_is_leaked = false;
    let state = 0;
    setInterval(function () {
      var response = httpData();
      httpTriggerBySecond();
      var obj = JSON.parse(response);
      console.log(obj);
      //get a random  number from 0 to 100
      let random1 = Math.floor(Math.random() * 100);
      let random2 = Math.floor(Math.random() * 100);
      document.getElementById("lastUpdated").innerHTML = obj["time"];
      document.getElementById("deviceName").innerHTML = obj["deviceName"];
      document.getElementById("pressure").innerHTML = parseInt(obj["pressure"]) / 10;
      document.getElementById("flow").innerHTML = parseInt(obj["flow"]) / 10;
      valve_state = parseInt(obj["valve"]);
      state = parseInt(obj["state"]);
      //change the flexSwitchCheckTrigger to on if valve_state is 0
      if (valve_state == 0) {
        // if coolDown wait 3 seconds to check again
        if (coolDown) {
          setTimeout(function () {
            coolDown = false;
          }, 2500);
        } else {
          document.getElementById("flexSwitchCheckTrigger").checked = true;
        }
      } else {
        if (coolDown) {
          setTimeout(function () {
            coolDown = false;
          }, 2500);
        } else {
          document.getElementById("flexSwitchCheckTrigger").checked = false;
        }
      }
      console.log(state);
      if (state == 0) {
        document.getElementById("state_desc").innerHTML = "No Usage";
        document.getElementById("state_desc_box").classList.remove("bg-success");
        document.getElementById("state_desc_box").classList.remove("bg-danger");
        document.getElementById("state_desc_box").classList.add("bg-secondary");
        document.getElementById("state_desc_box").classList.add("text-white");
        last_state_is_leaked = false;
      } else if(state > 0) {
        document.getElementById("state_desc").innerHTML = "Water Running";
        document.getElementById("state_desc_box").classList.remove("bg-secondary");
        document.getElementById("state_desc_box").classList.remove("bg-danger");
        document.getElementById("state_desc_box").classList.add("bg-success");
        document.getElementById("state_desc_box").classList.add("text-white");
        last_state_is_leaked = false;
      } else {
        document.getElementById("state_desc").innerHTML = "Leaking Detected";
        document.getElementById("state_desc_box").classList.remove("bg-success");
        document.getElementById("state_desc_box").classList.remove("bg-danger");
        document.getElementById("state_desc_box").classList.add("bg-danger");
        document.getElementById("state_desc_box").classList.add("text-white");
        if (!last_state_is_leaked) {
          $('#myModal').modal('show');
        }
        last_state_is_leaked = true;
        //show modal
      }
      console.log(state);
    }, 2500);

    function showDebug() {
      if (document.getElementById("debug_box").classList.contains("d-none")) {
        document.getElementById("debug_box").classList.remove("d-none");
      } else {
        document.getElementById("debug_box").classList.add("d-none");
      }
    }
  </script>
  <!-- <script type="module">
    // enable bootstrap 5.2 tooltips and popovers, toasts
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl)
    })
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
    var toastElList = [].slice.call(document.querySelectorAll('.toast'))
    var toastList = toastElList.map(function (toastEl) {
      return new bootstrap.Toast(toastEl)
    });
  </script> -->
</body>

</html>